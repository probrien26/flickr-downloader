{% extends "base.html" %}
{% block content %}
<div class="auth-wrap">
    <div class="auth-card">
        <h2>Set Up Two-Factor Authentication</h2>

        <p class="hint">Scan this QR code with Google Authenticator, then enter the 6-digit code below to verify.</p>

        <div class="qr-wrap">
            <img src="{{ qr_data_uri }}" alt="TOTP QR Code">
        </div>

        <p class="hint" style="margin-bottom:4px">Or enter this secret manually:</p>
        <div class="secret-display">{{ secret }}</div>

        <form method="POST">
            <input type="hidden" name="secret" value="{{ secret }}">
            <label for="code">Verification Code</label>
            <input type="text" id="code" name="code" autofocus required
                   inputmode="numeric" autocomplete="one-time-code"
                   maxlength="6" pattern="[0-9]{6}"
                   placeholder="000000"
                   style="text-align:center;letter-spacing:6px;font-size:20px">
            <button type="submit" class="btn btn-primary btn-block">Verify &amp; Complete Setup</button>
        </form>

        {% if setup_complete %}
        <div class="flash success" style="margin-top:16px">
            <strong>2FA is active!</strong> Copy the secret below and add it as the
            <code>TOTP_SECRET</code> environment variable on Render so it persists across deploys.
        </div>
        <div class="secret-display">{{ confirmed_secret }}</div>
        {% endif %}
    </div>
</div>
{% endblock %}
